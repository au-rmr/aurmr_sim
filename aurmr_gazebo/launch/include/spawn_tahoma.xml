<launch>
    <arg name="x" default="0.0" />
    <arg name="y" default="0.0" />
    <arg name="z" default="0.0" />
    <arg name="yaw" default="0.0" />
    <arg name="realsense" default="true" />

    <!-- Controller configuration -->
    <arg name="controller_config_file" default="$(find aurmr_gazebo)/config/tahoma_controllers.yaml" doc="Config file used for defining the ROS-Control controllers."/>
    <arg name="gripper_controller_config_file" default="$(find aurmr_gazebo)/config/2f_85_gripper_controllers.yaml" doc="Config file used for defining the gripper's ROS-Control controllers."/>
    <arg name="controllers" default="joint_state_controller pos_joint_traj_controller gripper_controller" doc="Controllers that are activated by default."/>
    <arg name="stopped_controllers" default="joint_group_pos_controller" doc="Controllers that are initally loaded, but not started."/>

    <!-- Load controller settings -->
    <rosparam file="$(arg controller_config_file)" command="load"/>
    <rosparam file="$(arg gripper_controller_config_file)" command="load"/>

    <!-- URDF and TF support -->
    <param name="robot_description" command="xacro $(find aurmr_gazebo)/robots/tahoma.gazebo.xacro" />
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" >
        <param name="publish_frequency" value="100.0"/>
    </node>

    <!-- Put a robot in gazebo, make it look pretty -->
    <node name="tahoma_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
          args="-urdf -x $(arg x) -y $(arg y) -z $(arg z) -Y $(arg yaw) -J arm_shoulder_lift_joint -1.57 -J arm_shoulder_pan_joint -1.57 -model tahoma -param robot_description"/>


    <!-- Load and start the controllers listed in the 'controllers' arg. -->
    <node name="ros_control_controller_spawner" pkg="controller_manager" type="spawner"
          args="$(arg controllers)" output="screen" respawn="false" />

    <!-- Load other controllers, but do not start them -->
    <node name="ros_control_stopped_spawner" pkg="controller_manager" type="spawner"
          args="--stopped $(arg stopped_controllers)" output="screen" respawn="false" />


    <group ns="stand_camera" if="$(arg realsense)">
        <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager"/>

        <node pkg="nodelet" type="nodelet" name="nodelet1"
              args="load depth_image_proc/register nodelet_manager">
            <remap from="rgb/camera_info" to="color/camera_info"/>
            <remap from="depth/camera_info" to="depth/camera_info"/>
            <remap from="depth/image_rect" to="depth/image_rect_raw"/>
            <remap from="depth_registered/camera_info" to="aligned_depth_to_color/camera_info"/>
            <remap from="depth_registered/image_rect" to="aligned_depth_to_color/image_raw"/>
        </node>

        <node pkg="nodelet" type="nodelet" name="nodelet2"
              args="load depth_image_proc/point_cloud_xyzrgb nodelet_manager">
            <remap from="rgb/image_rect_color" to="color/image_raw"/>
            <remap from="rgb/camera_info" to="color/camera_info"/>
            <remap from="depth_registered/camera_info" to="aligned_depth_to_color/camera_info"/>
            <remap from="depth_registered/image_rect" to="aligned_depth_to_color/image_raw"/>
            <remap from="depth_registered/points" to="depth/color/points"/>
        </node>
    </group>

</launch>
